version: '2'

services:
    db:
      image: postgres:9.6
      environment:
        - POSTGRES_PASSWORD=domino
        - POSTGRES_USER=domino
      expose:
        - "5432"
      ports:
        - "5432:5432"
      networks:
        - domino

    as:
      build: ./app/
      environment:
        - PYTHONPATH=/usr/src/app
        - DJANGO_SETTINGS_MODULE=app.settings
      volumes:
        - ./app:/usr/src/app
        - /var/run/docker.sock:/var/run/docker.sock
        - ~/.config/sublime-text-3/Packages/Anaconda:/opt/anaconda
      ports:
        - "80:8000"
        - "19360:19360" # for anaconda miniserver
      links:
        - db:db
      networks:
        - domino
      working_dir: /usr/src/app
      command: python manage.py runserver 0.0.0.0:8000

networks:
    domino:
      driver: bridge
      ipam:
        driver: default
        config:
          - subnet: 10.126.0.0/24
